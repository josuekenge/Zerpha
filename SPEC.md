# 1. Product Overview

**Name:** Zerpha
**Type:** AI-powered Vertical SaaS Market Intelligence Dashboard

## Goal
Given a user search like "CRM" or "logistics" or "home healthcare", Zerpha finds up to 5 relevant SaaS companies in that niche. It prefers vertical SaaS companies, but if no clear vertical SaaS exists, general SaaS in that niche is acceptable.

The system scrapes and analyzes their websites, extracts structured insights using Claude, and displays them in a dashboard similar in spirit to Apollo, but simpler. It also lets the user export a slide deck style PDF for a chosen company using Gemini plus Google Slides.

**Target User:** Analyst, tech lead, or M&A oriented engineer who wants a fast, high-level view of SaaS companies in a market.

# 2. Final Tech Stack

## Frontend
*   **React**
*   **TypeScript**
*   **Tailwind CSS**: HTML and basic CSS handled through utility classes.
*   *Note: The frontend talks only to your backend, never directly to AI APIs.*

## Backend
*   **Node.js**
*   **Express.js**
*   **TypeScript**

## Database
*   **Supabase**: Postgres as managed DB, Supabase JS client in backend.

## External APIs
*   **Claude API (Model: Claude 3.5 Sonnet)**
    *   Discover up to 5 SaaS companies for a given niche (preferring vertical SaaS).
    *   Extract structured insights from scraped HTML into JSON.

*   **Supabase API**
    *   Store searches, company data, and report metadata.
*   *ChatGPT API is optional, not required for MVP.*

# 3. Main User Flow

1.  User opens Zerpha and types a query in the search bar (e.g., "CRM" or "logistics software").
2.  Backend sends the query to Claude to find up to 5 relevant SaaS companies. It first tries vertical SaaS; if not possible, general SaaS in that niche is accepted.
3.  For each company, the backend:
    *   Scrapes key pages using fetch.
    *   Sends combined text to Claude for structured extraction.
    *   Saves the extracted JSON in Supabase.
4.  Frontend receives a list of companies and displays them in a dashboard table.
5.  User clicks one company to open the detail panel.


# 4. Functional Requirements

## 4.1 Search and Company Discovery
*   **Search Bar:** Accepts any string input (e.g., "CRM", "fleet management").
*   **Backend Discovery:** Sends a request to Claude with a hidden instruction to return up to 5 relevant SaaS companies, preferring vertical SaaS.
*   **Output:** Claude returns an array of JSON objects (max 5) containing name, website, and reason.

## 4.2 Scraping
For each company website, `scraperService` will use fetch to retrieve HTML for the Homepage, Product/Solutions page, and Pricing/How it works page. It will combine relevant text into a single string or chunked segments.
*   **Depth:** Medium.
*   **Timeouts:** 10 seconds per page request. If a page fails, skip and proceed.

## 4.3 Structured Extraction with Claude
`extractionService` takes the combined scraped text and uses Claude 3.5 Sonnet to output strict JSON.

**JSON Schema per Company:**
*   `name`, `website`, `summary`
*   `product_offering`, `customer_segment`, `tech_stack`
*   `estimated_headcount`, `hq_location`, `pricing_model`
*   `strengths` (list), `risks` (list), `opportunities` (list)
*   `acquisition_fit_score` (0-10), `acquisition_fit_reason`
*   `top_competitors` (list)

Additionally, a separate Claude call generates `global_opportunities` (short text describing top market opportunities in the niche).

**Reliability:**
*   Use try/catch.
*   If JSON is invalid, retry once asking for corrected JSON.
*   If extraction fails, mark company as "failed" and exclude/show error.

## 4.4 Dashboard UI
**Style:** Apollo vibes, but simpler.

**Key Components:**
*   **Top Search Bar:** Text input and search button.
*   **Global Insights Section:** Shows `global_opportunities` generated by Claude.
*   **Companies Table:** Columns for Name, Website, Short Summary, Acquisition Fit Score. Row click selects company.
*   **Detail Panel:** Shows all extracted fields (Summary, Product, Tech Stack, Strengths/Risks/Opportunities, Fit Score, Competitors).
*   *No logos for MVP.*



# 5. Non-Functional Requirements

*   **Response Time:** Total flow per search can take up to 3 minutes (use loading indicators).
*   **Throughput:** Max 5 companies per search.
*   **Parallelism:** Process 1 or 2 companies in parallel for reliability.
*   **Rate Limit:** No strict limit for MVP, but backend handles one search at a time per client.
*   **Error Handling:** If a company fails, skip it; never crash the whole search.

# 6. Data Model and Supabase Plan

Use Supabase as managed Postgres.

**Tables:**
*   `searches`: `id`, `query_text`, `created_at`
*   `companies`: `id`, `search_id` (FK), `name`, `website`, `vertical_query`, `raw_json`, `acquisition_fit_score`, `created_at`
*   `reports`: `id`, `company_id` (FK), `pdf_url` (or storage key), `created_at`

**Usage:** Backend only (Supabase JS client). Creates rows on search, extraction, and export events.

# 7. Backend Architecture

**Routes:**
*   `POST /api/search`: Body `{ query }`. Inserts search, calls Claude discovery, scrapes/extracts for each company, generates global insights, and returns list.
*   `GET /api/search/:searchId`: Returns existing data from DB (no new AI calls).


**Services:**
*   `discoveryService.ts`: Claude discovery.
*   `scraperService.ts`: Fetch HTML.
*   `extractionService.ts`: Claude JSON extraction.

*   `dbService.ts`: Supabase wrapper.

# 8. Frontend Architecture

*   **Stack:** React, TypeScript, Tailwind.
*   **Components:** `SearchPage`, `GlobalInsightsBox`, `CompaniesTable`, `CompanyDetailPanel`.
*   **State:** React Query or hooks for API calls.

# 9. AI Use Summary

*   **Claude 3.5 Sonnet:** Company discovery, structured extraction.

*   **Supabase:** Data persistence.

---

# 10. Implementation Details (Updated 2025-12-03)

## 1. Frontend Implementation
**Tech Stack:** React, Vite, TypeScript, Tailwind CSS, Framer Motion

### 1.1 Landing Page
**Features Implemented:**
*   **Hero Section:** Dynamic typewriter effect, search simulation, emotional gradient background.
*   **About Me Section:** High-level professional profile with experience timeline, education, skills, and social links.
*   **Vision & Capabilities:** "The Zerpha Advantage" highlights and interactive cards.
*   **Pricing:** Tiered pricing display with hover effects.
*   **Navigation:** Sticky navbar with smooth scroll and mobile menu.
*   **Chat Widget:** Integrated support interface.

### 1.2 Authentication (Frontend)
**Features Implemented:**
*   **Auth Context:** `useAuth` hook and protected route wrappers.
*   **UI Integration:** Conditional rendering of login/workspace buttons.

## 2. Backend Implementation
**Tech Stack:** Node.js, Express, TypeScript

### 2.1 Core Services
**Features Implemented:**
*   **Discovery Service:**
    *   AI model interface and discovery algorithms.
    *   **Validation:** Zod schema validation for Claude responses (`discoverySchema`).
    *   **Deduplication:** `diversityService` filters candidates against seen domains (`getSeenDomains`, `selectDiverseCompanies`).
*   **AI Integration:** Claude 4.5 (`@anthropic-ai/sdk`).
*   **Data Processing:** PDF parsing (`pdf-parse`) and Zod validation.
*   **Caching:** In-memory caching (`cacheService.ts`) for company extractions (30 min TTL) to avoid redundant AI calls.
*   **Global Opportunities:** Generated via `insightsService` and stored in `searches.global_opportunities`.

### 2.2 API & Security
**Features Implemented:**
*   **API Structure:** RESTful endpoints and structured logging (`pino`).
*   **Security:** `helmet` headers and `cors` configuration.
*   **Missing:** Rate limiting (Needs implementation).

### 2.3 Authentication (Backend)
**Features Implemented:**
*   **Middleware:** Supabase JWT verification and RBAC foundations.

### 2.4 Scraping Rules (Verified)
*   **Timeout:** 8 seconds per page request (`scraperService.ts`).
*   **Content Limit:** Combined text truncated to 15,000 characters before extraction.
*   **Stripping:** HTML tags (`script`, `style`) removed; whitespace normalized.

## 3. Storage & Infrastructure
**Provider:** Supabase

### 3.1 Data Persistence
**Features Implemented:**
*   **Database:** Managed PostgreSQL with tables for `searches`, `companies`, `reports`.
*   **Storage:** File asset storage configured.

### 3.2 Authentication & User Management
**Features Implemented:**
*   **Supabase Auth:** Client/Server auth flow and session persistence.

### 3.3 Deployment
**Features Implemented:**
*   **Environment:** `dotenv` management and TypeScript build system.
